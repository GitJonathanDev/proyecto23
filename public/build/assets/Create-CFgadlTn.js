import{T as ee,d as g,B as T,l as q,s as z,e as c,b as O,a as e,F as v,h as w,f as k,i as j,k as a,z as p,g as A,w as oe,t as d,C as D,x as te,o as u,v as ne}from"./app-C6Ljm75g.js";import{p as se}from"./plantillanav-IzOOFMsV.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";const le={name:"VentaMembresia",components:{plantillanav:se},setup(){const i=ee({clienteSearch:"",descripcion:"",codClienteF:"",telefono:"",codEncargadoF:"14623330",precioTotal:0,fechaInicio:"",fechaFin:"",codServiciosF:"",tipoServicioF:"",subTotal:0,montoTotal:0,servicios:[]}),n=g([]),_=g([]),t=g([]),C=g(!1),V=T({nombreServicio:""}),I=g(""),S=T({}),o=T({}),r=g([]),B=q(()=>i.descripcion.trim()===""||typeof i.codClienteF=="string"&&i.codClienteF.trim()===""||t.value.length===0),E=q(()=>t.value.reduce((s,l)=>s+l.subTotal,0)),L=async()=>{if(i.clienteSearch.length>=2)try{const s=await D.get(`/clientes/buscar?query=${i.clienteSearch}`);n.value=s.data}catch(s){console.error(s)}},R=s=>{s&&s.carnetIdentidad&&(i.codClienteF=s.carnetIdentidad,i.telefono=s.telefono,i.clienteSearch=`${s.nombre} ${s.apellidoPaterno}`,n.value=[],P())},Y=async()=>{try{const s=await D.get(`/servicios/buscar?search=${V.nombreServicio}`);_.value=s.data}catch(s){console.error(s)}},U=T({}),M=()=>new Date().toISOString().split("T")[0],H=s=>{if(t.value.find(F=>F.codServicio===s.codServicio))return;const m=U[s.codServicio]||M(),b=S[s.codServicio],f=s.precios.find(F=>F.codPrecioServicio===b),y=o[s.codServicio]||1,x=N(m,f.tipo,y);i.fechaInicio=m,i.fechaFin=x,i.codServiciosF=s.codServicio,i.tipoServicioF=f?f.tipo:"Desconocido";const h=f.precio*y;if(isNaN(h)||h<=0){console.error("El subTotal no es válido:",h);return}i.subTotal=h;const Z={...s,tipo:f?f.tipo:"Desconocido",precio:f?f.precio:0,cantidad:y,fechaFin:x,fechaInicio:m,subTotal:h};t.value.push(Z),i.precioTotal=E.value,i.montoTotal=t.value.reduce((F,$)=>F+$.subTotal,0),C.value=!1,P()},G=s=>t.value.some(l=>l.codServicio===s.codServicio),J=s=>{t.value.splice(s,1)},K=()=>{const s=t.value.map(l=>({codServicio:l.codServicio,tipoServicioF:l.tipo,fechaInicio:l.fechaInicio,fechaFin:l.fechaFin,subTotal:l.subTotal}));i.servicios=s,i.post(route("membresia.store")).then(()=>{te.get(route("membresia.index"))}).catch(l=>{console.error("Error completo:",l),l.response?console.error("Errores en la respuesta:",l.response.data.errors):l.request?console.error("No se recibió respuesta:",l.request):console.error("Error desconocido:",l.message)})},Q=async()=>{try{const s=await D.get("/servicios/todos");_.value=s.data}catch(s){console.error("Error al cargar los servicios:",s)}},W=()=>{C.value=!0,Q()},N=(s,l,m)=>{const b=new Date(s);return l==="Diario"?b.setDate(b.getDate()+m):l==="Mensual"?b.setMonth(b.getMonth()+m):l==="Anual"&&b.setFullYear(b.getFullYear()+m),b.toISOString().split("T")[0]},X=s=>{const l=S[s.codServicio],m=s.precios.find(h=>h.codPrecioServicio===l),b=o[s.codServicio]||1,f=U[s.codServicio]||M(),y=N(f,m.tipo,b),x=t.value.findIndex(h=>h.codServicio===s.codServicio);x!==-1&&(t.value[x].fechaFin=y)},P=()=>{const s=t.value.length>0,l=i.descripcion.trim(),m=i.codClienteF&&typeof i.codClienteF=="string"&&i.codClienteF.trim()!=="";return!(s&&l&&m)};return{form:i,clientes:n,servicios:_,showModal:C,search:V,qrUrl:I,selectedTipo:S,cantidad:o,serviciosSeleccionados:t,isSubmitDisabled:B,precioTotal:E,errors:r,handleSubmit:K,removeServicio:J,selectClient:R,searchClient:L,searchServices:Y,selectServicio:H,showServicesModal:W,updateFechaFin:X,fechaInicio:U,isTipoSeleccionado:G,currentDate:M}}},re={class:"py-12"},ae={class:"max-w-4xl mx-auto"},de={class:"bg-white shadow-lg rounded-lg border-t-4 border-green-500"},ce={class:"p-6"},pe={key:0,class:"alert alert-danger mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded"},ue={class:"mb-4"},me={key:0,class:"mt-2 max-h-40 overflow-y-auto border border-gray-300 rounded-lg shadow-lg"},be=["onClick"],fe={class:"mb-4"},he=["disabled"],ge=["href"],ve={key:0,class:"fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center"},Se={class:"bg-white rounded-lg p-6 max-w-4xl w-full"},ye={class:"flex justify-between items-center"},xe={class:"mb-4"},Fe={class:"table-responsive overflow-x-auto"},we={class:"table-auto w-full text-sm border-collapse"},_e={class:"px-4 py-2"},Ce={class:"px-4 py-2"},Te={class:"px-4 py-2"},ke=["onUpdate:modelValue","disabled"],Ve=["value"],Ie={class:"px-4 py-2"},Ue={class:"px-4 py-2"},Me=["onUpdate:modelValue","onInput","disabled"],De={class:"px-4 py-2"},Be=["onUpdate:modelValue","onChange","disabled","value"],Ee={class:"px-4 py-2"},Ne=["onClick","disabled"],Pe={class:"flex justify-between mt-4"},qe={class:"mt-8 max-w-4xl mx-auto"},ze={class:"bg-white shadow-lg rounded-lg border-t-4 border-green-500"},Oe={class:"p-6"},je={class:"table-auto w-full text-sm border-collapse"},Ae={class:"px-4 py-2"},Le={class:"px-4 py-2"},Re={class:"px-4 py-2"},Ye={class:"px-4 py-2"},He={class:"px-4 py-2"},Ge={class:"px-4 py-2"},Je={class:"px-4 py-2"},Ke=["onClick"],Qe={class:"mt-4 text-xl font-semibold"},We={class:"mt-8 max-w-sm mx-auto"},Xe={class:"bg-white shadow-lg rounded-lg border-t-4 border-green-500"},Ze={class:"p-6"},$e={class:"text-3xl font-bold text-center"};function eo(i,n,_,t,C,V){const I=z("plantillanav"),S=z("Link");return u(),c(v,null,[O(I),e("div",re,[e("div",ae,[e("div",de,[n[24]||(n[24]=e("div",{class:"bg-green-600 text-white p-4 rounded-t-lg"},[e("h5",{class:"text-lg font-semibold"},"Realizar Venta de Membresía")],-1)),e("div",ce,[t.errors&&t.errors.length>0?(u(),c("div",pe,[e("ul",null,[(u(!0),c(v,null,w(t.errors,o=>(u(),c("li",{key:o},d(o),1))),128))])])):k("",!0),e("form",{onSubmit:n[14]||(n[14]=j((...o)=>t.handleSubmit&&t.handleSubmit(...o),["prevent"]))},[a(e("input",{type:"hidden","onUpdate:modelValue":n[0]||(n[0]=o=>t.form.tipoServicioF=o)},null,512),[[p,t.form.tipoServicioF]]),a(e("input",{type:"hidden","onUpdate:modelValue":n[1]||(n[1]=o=>t.form.codServiciosF=o)},null,512),[[p,t.form.codServiciosF]]),a(e("input",{type:"hidden","onUpdate:modelValue":n[2]||(n[2]=o=>t.form.precioTotal=o)},null,512),[[p,t.form.precioTotal]]),a(e("input",{type:"hidden","onUpdate:modelValue":n[3]||(n[3]=o=>t.form.fechaInicio=o)},null,512),[[p,t.form.fechaInicio]]),a(e("input",{type:"hidden","onUpdate:modelValue":n[4]||(n[4]=o=>t.form.fechaFin=o)},null,512),[[p,t.form.fechaFin]]),a(e("input",{type:"hidden","onUpdate:modelValue":n[5]||(n[5]=o=>t.form.codClienteF=o)},null,512),[[p,t.form.codClienteF]]),a(e("input",{type:"hidden","onUpdate:modelValue":n[6]||(n[6]=o=>t.form.telefono=o)},null,512),[[p,t.form.telefono]]),a(e("input",{type:"hidden","onUpdate:modelValue":n[7]||(n[7]=o=>t.form.codEncargadoF=o)},null,512),[[p,t.form.codEncargadoF]]),a(e("input",{type:"hidden","onUpdate:modelValue":n[8]||(n[8]=o=>t.form.subTotal=o)},null,512),[[p,t.form.subTotal]]),a(e("input",{type:"hidden","onUpdate:modelValue":n[9]||(n[9]=o=>t.form.montoTotal=o)},null,512),[[p,t.form.montoTotal]]),e("div",ue,[n[20]||(n[20]=e("label",{for:"buscarCliente",class:"block text-sm font-medium text-gray-700"},"Buscar Cliente:",-1)),a(e("input",{type:"text",class:"mt-2 p-2 w-full border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500","onUpdate:modelValue":n[10]||(n[10]=o=>t.form.clienteSearch=o),onInput:n[11]||(n[11]=(...o)=>t.searchClient&&t.searchClient(...o)),placeholder:"Buscar cliente..."},null,544),[[p,t.form.clienteSearch]]),t.clientes.length?(u(),c("ul",me,[(u(!0),c(v,null,w(t.clientes,o=>(u(),c("li",{key:o.carnetIdentidad,class:"px-4 py-2 hover:bg-gray-200 cursor-pointer",onClick:r=>t.selectClient(o)},d(o.nombre)+" "+d(o.apellidoPaterno),9,be))),128))])):k("",!0)]),e("div",fe,[n[21]||(n[21]=e("label",{for:"descripcion",class:"block text-sm font-medium text-gray-700"},"Descripción:",-1)),a(e("input",{type:"text",id:"descripcion",class:"mt-2 p-2 w-full border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500","onUpdate:modelValue":n[12]||(n[12]=o=>t.form.descripcion=o)},null,512),[[p,t.form.descripcion]])]),e("button",{type:"button",class:"btn btn-success mb-3 bg-green-600 text-white hover:bg-green-700 p-2 rounded-lg",onClick:n[13]||(n[13]=(...o)=>t.showServicesModal&&t.showServicesModal(...o))},n[22]||(n[22]=[e("i",{class:"fas fa-search mr-2"},null,-1),A(" Buscar Servicio ")])),e("button",{type:"submit",class:"bg-green-600 text-white hover:bg-green-700 p-2 rounded-lg w-full",disabled:t.isSubmitDisabled}," Realizar Venta de Membresía ",8,he),i.membresia?(u(),c("a",{key:0,href:`/membresia/${i.membresia.codMembresia}`,class:"block text-center mt-4 text-blue-600 hover:underline"}," Ver Detalle de Venta de Membresía ",8,ge)):k("",!0),O(S,{href:i.route("membresia.index"),class:"btn btn-secondary me-3"},{default:oe(()=>n[23]||(n[23]=[A(" Atrás ")])),_:1},8,["href"])],32)])])]),t.showModal?(u(),c("div",ve,[e("div",Se,[e("div",ye,[n[25]||(n[25]=e("h1",{class:"text-lg font-semibold"},"Buscar Servicio",-1)),e("button",{onClick:n[15]||(n[15]=o=>t.showModal=!1),class:"text-red-600 text-xl"},"×")]),e("form",{onSubmit:n[17]||(n[17]=j((...o)=>t.searchServices&&t.searchServices(...o),["prevent"]))},[e("div",xe,[n[26]||(n[26]=e("label",{for:"nombreServicio",class:"block text-sm font-medium text-gray-700"},"Buscar por Nombre:",-1)),a(e("input",{type:"text",class:"mt-2 p-2 w-full border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500","onUpdate:modelValue":n[16]||(n[16]=o=>t.search.nombreServicio=o),placeholder:"Ingrese el nombre del servicio"},null,512),[[p,t.search.nombreServicio]])])],32),e("div",Fe,[e("table",we,[n[27]||(n[27]=e("thead",{class:"bg-gray-100 text-left"},[e("tr",null,[e("th",{class:"px-4 py-2"},"Nombre"),e("th",{class:"px-4 py-2"},"Descripción"),e("th",{class:"px-4 py-2"},"Tipo"),e("th",{class:"px-4 py-2"},"Horario"),e("th",{class:"px-4 py-2"},"Cantidad"),e("th",{class:"px-4 py-2"},"Fecha de Inicio"),e("th",{class:"px-4 py-2"},"Opción")])],-1)),e("tbody",null,[(u(!0),c(v,null,w(t.servicios,o=>(u(),c("tr",{key:o.codServicio},[e("td",_e,d(o.nombre),1),e("td",Ce,d(o.descripcion),1),e("td",Te,[a(e("select",{"onUpdate:modelValue":r=>t.selectedTipo[o.codServicio]=r,class:"w-full p-2 border border-gray-300 rounded-lg",disabled:t.isTipoSeleccionado(o)},[(u(!0),c(v,null,w(o.precios,r=>(u(),c("option",{key:r.codPrecioServicio,value:r.codPrecioServicio},d(r.tipo)+" - "+d(r.precio)+" Bs. ",9,Ve))),128))],8,ke),[[ne,t.selectedTipo[o.codServicio]]])]),e("td",Ie,d(o.horario?o.horario.horaInicio+" - "+o.horario.horaFin:"Sin horario"),1),e("td",Ue,[a(e("input",{type:"number","onUpdate:modelValue":r=>t.cantidad[o.codServicio]=r,min:"1",value:"1",class:"p-1 w-16 border border-gray-300 rounded-lg",onInput:r=>t.updateFechaFin(o),disabled:t.isTipoSeleccionado(o)},null,40,Me),[[p,t.cantidad[o.codServicio]]])]),e("td",De,[a(e("input",{type:"date","onUpdate:modelValue":r=>t.fechaInicio[o.codServicio]=r,class:"p-2 border border-gray-300 rounded-lg",onChange:r=>t.updateFechaFin(o),disabled:t.isTipoSeleccionado(o),value:t.fechaInicio[o.codServicio]||t.currentDate()},null,40,Be),[[p,t.fechaInicio[o.codServicio]]])]),e("td",Ee,[e("button",{type:"button",class:"bg-green-600 text-white p-2 rounded-lg hover:bg-green-700",onClick:r=>t.selectServicio(o),disabled:t.isTipoSeleccionado(o)}," Seleccionar ",8,Ne)])]))),128))])])]),e("div",Pe,[e("button",{onClick:n[18]||(n[18]=o=>t.showModal=!1),class:"bg-gray-300 text-gray-700 p-2 rounded-lg"},"Cerrar"),e("button",{onClick:n[19]||(n[19]=(...o)=>i.confirmSelection&&i.confirmSelection(...o)),class:"bg-green-600 text-white p-2 rounded-lg hover:bg-green-700"},"Confirmar Selección")])])])):k("",!0),e("div",qe,[e("div",ze,[n[29]||(n[29]=e("div",{class:"bg-green-600 text-white p-4 rounded-t-lg"},[e("h5",{class:"text-lg font-semibold"},"Servicios Seleccionados")],-1)),e("div",Oe,[e("table",je,[n[28]||(n[28]=e("thead",{class:"bg-gray-100 text-left"},[e("tr",null,[e("th",{class:"px-4 py-2"},"Nombre"),e("th",{class:"px-4 py-2"},"Descripción"),e("th",{class:"px-4 py-2"},"Tipo"),e("th",{class:"px-4 py-2"},"Precio"),e("th",{class:"px-4 py-2"},"Subtotal"),e("th",{class:"px-4 py-2"},"Fecha Fin"),e("th",{class:"px-4 py-2"},"Opción")])],-1)),e("tbody",null,[(u(!0),c(v,null,w(t.serviciosSeleccionados,(o,r)=>(u(),c("tr",{key:r},[e("td",Ae,d(o.nombre),1),e("td",Le,d(o.descripcion),1),e("td",Re,d(o.tipo),1),e("td",Ye,d(o.precio)+" Bs.",1),e("td",He,d((o.precio*o.cantidad).toFixed(2))+" Bs.",1),e("td",Ge,d(o.fechaFin),1),e("td",Je,[e("button",{type:"button",class:"bg-red-600 text-white p-2 rounded-lg hover:bg-red-700",onClick:B=>t.removeServicio(r)}," Eliminar ",8,Ke)])]))),128))])]),e("p",Qe,"Total: Bs. "+d(t.precioTotal.toFixed(2)),1)])])]),e("div",We,[e("div",Xe,[n[30]||(n[30]=e("div",{class:"bg-green-600 text-white p-4 rounded-t-lg"},[e("h5",{class:"text-lg font-semibold"},"Total de la Membresía")],-1)),e("div",Ze,[e("p",$e,d(t.precioTotal.toFixed(2))+" Bs.",1)])])])])],64)}const so=ie(le,[["render",eo],["__scopeId","data-v-449db7ad"]]);export{so as default};
