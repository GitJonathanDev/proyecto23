import{Q,d as r,l as E,q as j,s as H,e as a,b as I,w as b,F as g,o as l,a as e,i as J,h as _,t as n,f as F,k as i,z as u,u as f,g as N,x as G}from"./app-C6Ljm75g.js";import{a as K}from"./DialogModal-4e0TKDxe.js";import{p as W}from"./plantillanav-IzOOFMsV.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Y={class:"py-12"},Z={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},ee={key:0,class:"alert alert-danger bg-red-100 text-red-800 p-4 rounded-md"},te={class:"form-group"},oe={class:"text-lg font-semibold"},se={class:"form-group"},ae={key:0,class:"mt-2 max-h-40 overflow-y-auto border border-gray-300 rounded-lg shadow-lg"},le=["onClick"],ne={class:"form-group"},re={class:"flex space-x-4"},de=["disabled"],ie={key:1},ue=["href"],ce=["href"],pe={class:"form-group mb-4"},me={class:"table-responsive overflow-x-auto"},be={class:"table table-striped w-full text-sm"},ge={class:"py-2 px-4"},fe={class:"py-2 px-4"},ve={class:"py-2 px-4"},xe={class:"py-2 px-4"},ye={class:"py-2 px-4"},he=["src"],_e={key:1},we={class:"py-2 px-4"},Ce=["onClick"],Ve={class:"mt-6"},ke={class:"table table-striped w-full text-sm mt-4"},Pe={class:"py-2 px-4"},Be={class:"py-2 px-4"},Se=["onUpdate:modelValue"],Ie={class:"py-2 px-4"},Fe={class:"py-2 px-4"},Ne={class:"py-2 px-4"},$e=["onClick"],Ue={class:"mt-6"},Le={class:"text-xl font-bold text-green-600"},Ee={__name:"Create",setup(Me){const{props:v}=Q(),p=v.encargado,M=v.clientes,T=r(v.productos||[]),$=v.venta||null,m=r([]),c=r(""),w=r(!1),U=r(""),d=r([]),C=r(0),V=r(p?p.carnetIdentidad:""),L=r(""),k=r(new Date().toISOString().split("T")[0]),P=E(()=>JSON.stringify(d.value)),B=E(()=>C.value.toFixed(2)),x=r([]),z=s=>{const t=d.value.find(S=>S.id===s.codProducto);t?t.cantidad++:d.value.push({id:s.codProducto,nombre:s.nombre,precio:s.precio,cantidad:1}),y()},D=()=>{c.value.trim()===""?m.value=[]:m.value=M.filter(s=>s.nombre.toLowerCase().includes(c.value.toLowerCase())||s.apellidoPaterno.toLowerCase().includes(c.value.toLowerCase()))},q=s=>{L.value=s.carnetIdentidad,c.value=`${s.nombre} ${s.apellidoPaterno}`,m.value=[]},y=()=>{C.value=d.value.reduce((s,t)=>s+t.cantidad*t.precio,0)},A=s=>{d.value=d.value.filter(t=>t.id!==s),y()},O=()=>{const s={codEncargadoF:V.value,codClienteF:L.value,fechaVenta:k.value,productosSeleccionados:P.value,totalVenta:B.value};axios.post(route("venta.store"),s).then(()=>{G.get(route("venta.index"))}).catch(t=>{t.response?x.value=t.response.data.errors||[]:(console.error("Error de red o problema con el servidor:",t),x.value=["Hubo un error al procesar la solicitud. Inténtalo más tarde."])})},R=()=>{w.value=!0};return j(d,y,{deep:!0}),(s,t)=>{const S=H("AppLayout");return l(),a(g,null,[I(W,{userName:s.$page.props.auth.user.name},null,8,["userName"]),I(S,{title:"Realizar Venta"},{header:b(()=>t[7]||(t[7]=[e("h2",{class:"font-semibold text-2xl text-gray-800 leading-tight"},"Realizar Venta",-1)])),default:b(()=>[e("div",Y,[e("div",Z,[e("form",{onSubmit:J(O,["prevent"]),class:"space-y-6"},[x.value.length?(l(),a("div",ee,[e("ul",null,[(l(!0),a(g,null,_(x.value,o=>(l(),a("li",{key:o},n(o),1))),128))])])):F("",!0),i(e("input",{type:"hidden","onUpdate:modelValue":t[0]||(t[0]=o=>P.value=o)},null,512),[[u,P.value]]),i(e("input",{type:"hidden","onUpdate:modelValue":t[1]||(t[1]=o=>B.value=o)},null,512),[[u,B.value]]),e("div",te,[t[8]||(t[8]=e("label",{for:"encargado",class:"block text-sm font-medium text-gray-700"},"Encargado:",-1)),i(e("input",{type:"hidden","onUpdate:modelValue":t[2]||(t[2]=o=>V.value=o)},null,512),[[u,V.value]]),e("p",oe,n(f(p).nombre)+" "+n(f(p).apellidoPaterno)+" "+n(f(p).apellidoMaterno),1)]),e("div",se,[t[9]||(t[9]=e("label",{for:"buscarCliente",class:"block text-sm font-medium text-gray-700"},"Buscar Cliente:",-1)),i(e("input",{type:"text",class:"mt-2 p-2 w-full border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500","onUpdate:modelValue":t[3]||(t[3]=o=>c.value=o),onInput:D,placeholder:"Buscar cliente..."},null,544),[[u,c.value]]),m.value.length?(l(),a("ul",ae,[(l(!0),a(g,null,_(m.value,o=>(l(),a("li",{key:o.carnetIdentidad,class:"px-4 py-2 hover:bg-gray-200 cursor-pointer",onClick:h=>q(o)},n(o.nombre)+" "+n(o.apellidoPaterno),9,le))),128))])):F("",!0)]),e("div",ne,[t[10]||(t[10]=e("label",{for:"fechaventa",class:"block text-sm font-medium text-gray-700"},"Fecha:",-1)),i(e("input",{type:"date","onUpdate:modelValue":t[4]||(t[4]=o=>k.value=o),class:"form-input w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",required:""},null,512),[[u,k.value]])]),e("div",re,[e("button",{type:"button",class:"btn btn-primary mb-3 bg-blue-500 text-white p-2 rounded-md hover:bg-blue-600",onClick:R},t[11]||(t[11]=[e("i",{class:"fas fa-search"},null,-1),N(" Buscar Producto ")])),e("button",{type:"submit",class:"btn btn-primary mb-3 bg-green-500 text-white p-2 rounded-md hover:bg-green-600",disabled:d.value.length===0}," Realizar Venta ",8,de)]),f($)?(l(),a("div",ie,[e("a",{href:s.route("venta.show",f($).codVenta),class:"btn btn-info mb-3 bg-teal-500 text-white p-2 rounded-md hover:bg-teal-600"}," Ver Detalle de Venta ",8,ue)])):F("",!0),e("a",{href:s.route("venta.index"),class:"btn btn-secondary mb-3 bg-gray-500 text-white p-2 rounded-md hover:bg-gray-600"},t[12]||(t[12]=[e("i",{class:"fas fa-arrow-left"},null,-1),N(" Volver ")]),8,ce)],32),I(K,{show:w.value},{title:b(()=>t[13]||(t[13]=[e("h5",{class:"modal-title text-xl font-semibold text-gray-800"},"Buscar Producto",-1)])),content:b(()=>[e("div",pe,[t[14]||(t[14]=e("label",{for:"nombreProducto",class:"block text-sm font-medium text-gray-700"},"Buscar por Nombre:",-1)),i(e("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=o=>U.value=o),class:"form-input w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Ingrese el nombre del producto"},null,512),[[u,U.value]])]),e("div",me,[e("table",be,[t[15]||(t[15]=e("thead",{class:"bg-gray-100"},[e("tr",null,[e("th",{class:"py-2 px-4 text-left"},"Nombre"),e("th",{class:"py-2 px-4 text-left"},"Precio"),e("th",{class:"py-2 px-4 text-left"},"Stock"),e("th",{class:"py-2 px-4 text-left"},"Categoría"),e("th",{class:"py-2 px-4 text-left"},"Imagen"),e("th",{class:"py-2 px-4 text-left"},"Opción")])],-1)),e("tbody",null,[(l(!0),a(g,null,_(T.value,o=>(l(),a("tr",{key:o.codProducto},[e("td",ge,n(o.nombre),1),e("td",fe,n(o.precio)+" Bs.",1),e("td",ve,n(o.stock),1),e("td",xe,n(o.categoria?o.categoria.nombre:"Sin categoría"),1),e("td",ye,[o.imagen_url?(l(),a("img",{key:0,src:`/storage/uploads/${o.imagen_url}`,alt:"Imagen del producto",class:"img-thumbnail w-24 h-24 object-cover"},null,8,he)):(l(),a("span",_e,"No tiene imagen"))]),e("td",we,[e("button",{type:"button",class:"bg-blue-500 text-white p-2 rounded-md hover:bg-blue-600",onClick:h=>z(o)}," Seleccionar ",8,Ce)])]))),128))])])])]),footer:b(()=>[e("button",{type:"button",class:"btn btn-secondary bg-gray-500 text-white p-2 rounded-md hover:bg-gray-600",onClick:t[6]||(t[6]=o=>w.value=!1)}," Cerrar ")]),_:1},8,["show"]),e("div",Ve,[t[18]||(t[18]=e("h3",{class:"text-lg font-semibold text-gray-800"},"Productos Seleccionados",-1)),e("table",ke,[t[17]||(t[17]=e("thead",{class:"bg-gray-100"},[e("tr",null,[e("th",{class:"py-2 px-4 text-left"},"Nombre"),e("th",{class:"py-2 px-4 text-left"},"Cantidad"),e("th",{class:"py-2 px-4 text-left"},"Precio"),e("th",{class:"py-2 px-4 text-left"},"Subtotal"),e("th",{class:"py-2 px-4 text-left"},"Acción")])],-1)),e("tbody",null,[(l(!0),a(g,null,_(d.value,o=>(l(),a("tr",{key:o.id},[e("td",Pe,n(o.nombre),1),e("td",Be,[i(e("input",{type:"number","onUpdate:modelValue":h=>o.cantidad=h,min:"1",class:"form-input w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",onInput:y},null,40,Se),[[u,o.cantidad]])]),e("td",Ie,n(o.precio)+" Bs.",1),e("td",Fe,n((o.cantidad*o.precio).toFixed(2))+" Bs.",1),e("td",Ne,[e("button",{type:"button",class:"bg-red-500 text-white p-2 rounded-md hover:bg-red-600",onClick:h=>A(o.id)},t[16]||(t[16]=[e("i",{class:"fas fa-times"},null,-1),N(" Quitar ")]),8,$e)])]))),128))])])]),e("div",Ue,[t[19]||(t[19]=e("h3",{class:"text-lg font-semibold text-gray-800"},"Total de la Venta",-1)),e("p",Le,n(C.value.toFixed(2))+" Bs.",1)])])])]),_:1})],64)}}},Ae=X(Ee,[["__scopeId","data-v-61bdc3c6"]]);export{Ae as default};
