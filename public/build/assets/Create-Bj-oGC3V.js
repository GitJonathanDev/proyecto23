import{Q as A,d,l as U,q as L,s as O,e as l,b as h,w as b,F as f,o as r,a as t,i as R,h as _,t as s,f as E,k as i,z as c,u,v as Q,g as F,x as j}from"./app-C6Ljm75g.js";import{a as H}from"./DialogModal-4e0TKDxe.js";import{p as J}from"./plantillanav-IzOOFMsV.js";import{V as G}from"./VisitaFooter-fQvL4C6g.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                                                                     */const W={class:"divgrande rounded-2xl mb-12"},X={class:"py-12"},Y={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},Z={key:0,class:"alert alert-danger bg-red-100 text-red-800 p-4 rounded-md"},tt={class:"form-group"},et={class:"text-lg font-semibold"},ot={class:"form-group"},st=["value"],at={class:"form-group"},lt={class:"flex space-x-4"},rt=["disabled"],nt={key:1},dt=["href"],it=["href"],ct={class:"form-group mb-4"},ut={class:"overflow-x-auto mt-4"},mt={class:"table-auto w-full text-sm"},pt={class:"p-3"},bt={class:"p-3"},ft={class:"p-3"},gt={class:"p-3"},vt={class:"p-3"},xt=["src"],ht={key:1},_t={class:"p-3 text-center"},yt=["onClick"],wt={class:"mt-6"},Ct={class:"overflow-x-auto mt-4"},kt={class:"table-auto w-full text-sm"},Pt={class:"p-3"},Vt={class:"p-3"},St=["onUpdate:modelValue"],Bt={class:"p-3"},Ft={class:"p-3"},Nt={class:"p-3 text-center"},It=["onClick"],Ut={class:"mt-6 border-solid"},Et={class:"text-2xl font-bold bb pp"},Mt={__name:"Create",setup($t){const{props:g}=A(),m=g.encargado,M=g.proveedores,$=d(g.productos||[]),N=g.compra||null,y=d(!1),I=d(""),n=d([]),w=d(0),C=d(m?m.carnetIdentidad:""),k=d(""),P=d(new Date().toISOString().split("T")[0]),V=U(()=>JSON.stringify(n.value)),S=U(()=>w.value.toFixed(2)),v=d([]),T=a=>{const e=n.value.find(B=>B.id===a.codProducto);e?e.cantidad++:n.value.push({id:a.codProducto,nombre:a.nombre,precio:a.precio,cantidad:1}),x()},x=()=>{w.value=n.value.reduce((a,e)=>a+e.cantidad*e.precio,0)},q=a=>{n.value=n.value.filter(e=>e.id!==a),x()},z=()=>{const a={codEncargadoF:C.value,codProveedorF:k.value,fechaCompra:P.value,productosSeleccionados:V.value,totalCompra:S.value};axios.post(route("compra.store"),a).then(()=>{j.get(route("compra.index"))}).catch(e=>{e.response?v.value=e.response.data.errors||[]:(console.error("Error de red o problema con el servidor:",e),v.value=["Hubo un error al procesar la solicitud. Inténtalo más tarde."])})},D=()=>{y.value=!0};return L(n,x,{deep:!0}),(a,e)=>{const B=O("AppLayout");return r(),l(f,null,[h(J,{userName:a.$page.props.auth.user.name},null,8,["userName"]),h(B,{title:"Realizar Compra"},{header:b(()=>e[7]||(e[7]=[t("h2",{class:"font-semibold text-2xl text-gray-800 leading-tight"},"Realizar Compra",-1)])),default:b(()=>[t("div",W,[t("div",X,[t("div",Y,[t("form",{onSubmit:R(z,["prevent"]),class:"space-y-6"},[v.value.length?(r(),l("div",Z,[t("ul",null,[(r(!0),l(f,null,_(v.value,o=>(r(),l("li",{key:o},s(o),1))),128))])])):E("",!0),i(t("input",{type:"hidden","onUpdate:modelValue":e[0]||(e[0]=o=>V.value=o)},null,512),[[c,V.value]]),i(t("input",{type:"hidden","onUpdate:modelValue":e[1]||(e[1]=o=>S.value=o)},null,512),[[c,S.value]]),t("div",tt,[e[8]||(e[8]=t("label",{for:"encargado",class:"block text-sm font-medium text-gray-700 bb"},"Encargado:",-1)),i(t("input",{type:"hidden","onUpdate:modelValue":e[2]||(e[2]=o=>C.value=o)},null,512),[[c,C.value]]),t("p",et,s(u(m).nombre)+" "+s(u(m).apellidoPaterno)+" "+s(u(m).apellidoMaterno),1)]),t("div",ot,[e[9]||(e[9]=t("label",{for:"proveedor",class:"block text-sm font-medium text-gray-700 bb"},"Proveedor:",-1)),i(t("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>k.value=o),class:"form-select w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 cc",required:""},[(r(!0),l(f,null,_(u(M),o=>(r(),l("option",{key:o.codProveedor,value:o.codProveedor},s(o.nombre)+" - "+s(o.direccion)+" - "+s(o.telefono),9,st))),128))],512),[[Q,k.value]])]),t("div",at,[e[10]||(e[10]=t("label",{for:"fechacompra",class:"block text-sm font-medium text-gray-700 bb"},"Fecha:",-1)),i(t("input",{type:"date","onUpdate:modelValue":e[4]||(e[4]=o=>P.value=o),class:"form-input w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 cc",required:""},null,512),[[c,P.value]])]),t("div",lt,[t("button",{type:"button",class:"btn btn-primary mb-3 bg-blue-500 text-white p-2 rounded-md hover:bg-blue-600",onClick:D},e[11]||(e[11]=[t("i",{class:"fas fa-search"},null,-1),F(" Buscar Producto ")])),t("button",{type:"submit",class:"btn btn-primary mb-3 bg-green-500 text-white p-2 rounded-md hover:bg-green-600",disabled:n.value.length===0}," Realizar Compra ",8,rt)]),u(N)?(r(),l("div",nt,[t("a",{href:a.route("compra.show",u(N).codCompra),class:"btn btn-info mb-3 bg-teal-500 text-white p-2 rounded-md hover:bg-teal-600"}," Ver Detalle de Compra ",8,dt)])):E("",!0),t("a",{href:a.route("compra.index"),class:"btn btn-secondary mb-3 bg-gray-500 text-white p-2 rounded-md hover:bg-gray-600"},e[12]||(e[12]=[t("i",{class:"fas fa-arrow-left mt-5"},null,-1),F(" Volver ")]),8,it)],32),h(H,{show:y.value},{title:b(()=>e[13]||(e[13]=[t("h5",{class:"modal-title cc text-xl font-semibold text-gray-800 bb"},"Buscar Producto",-1)])),content:b(()=>[t("div",ct,[e[14]||(e[14]=t("label",{for:"nombreProducto",class:"block cc text-sm font-medium text-gray-700 bb"},"Buscar por Nombre:",-1)),i(t("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=o=>I.value=o),class:"form-input w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Ingrese el nombre del producto"},null,512),[[c,I.value]])]),t("div",ut,[t("table",mt,[e[15]||(e[15]=t("thead",{class:"bg-gray-100"},[t("tr",null,[t("th",{class:"p-3 text-left"},"Nombre"),t("th",{class:"p-3 text-left"},"Precio"),t("th",{class:"p-3 text-left"},"Stock"),t("th",{class:"p-3 text-left"},"Categoría"),t("th",{class:"p-3 text-left"},"Imagen"),t("th",{class:"p-3 text-center"},"Opción")])],-1)),t("tbody",null,[(r(!0),l(f,null,_($.value,o=>{var p;return r(),l("tr",{key:o.codProducto,class:"border-b"},[t("td",pt,s(o.nombre),1),t("td",bt,s(o.precio)+" Bs.",1),t("td",ft,s(o.stock),1),t("td",gt,s(((p=o.categoria)==null?void 0:p.nombre)??"No disponible"),1),t("td",vt,[o.imagen_url?(r(),l("img",{key:0,src:`/storage/uploads/${o.imagen_url}`,alt:"Imagen del producto",class:"img-thumbnail w-24 h-24 object-cover"},null,8,xt)):(r(),l("span",ht,"No tiene imagen"))]),t("td",_t,[t("button",{type:"button",class:"btn-primary text-white p-2 rounded-md",onClick:Tt=>T(o)}," Seleccionar ",8,yt)])])}),128))])])])]),footer:b(()=>[t("button",{type:"button",class:"btn btn-primary bg-gray-500 text-white p-2 rounded-md hover:bg-gray-600",onClick:e[6]||(e[6]=o=>y.value=!1)}," Cerrar ")]),_:1},8,["show"]),t("div",wt,[e[18]||(e[18]=t("h3",{class:"text-lg font-semibold text-gray-800 bb"},"Productos Seleccionados",-1)),t("div",Ct,[t("table",kt,[e[17]||(e[17]=t("thead",{class:"bg-gray-100"},[t("tr",null,[t("th",{class:"p-3 text-left"},"Nombre"),t("th",{class:"p-3 text-left"},"Cantidad"),t("th",{class:"p-3 text-left"},"Precio"),t("th",{class:"p-3 text-left"},"Subtotal"),t("th",{class:"p-3 text-center"},"Acción")])],-1)),t("tbody",null,[(r(!0),l(f,null,_(n.value,o=>(r(),l("tr",{key:o.id,class:"border-b"},[t("td",Pt,s(o.nombre),1),t("td",Vt,[i(t("input",{type:"number","onUpdate:modelValue":p=>o.cantidad=p,min:"1",class:"form-input w-full cc p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",onInput:x},null,40,St),[[c,o.cantidad]])]),t("td",Bt,s(o.precio)+" Bs.",1),t("td",Ft,s((o.cantidad*o.precio).toFixed(2))+" Bs.",1),t("td",Nt,[t("button",{type:"button",class:"btn-primary text-white p-2 rounded-md",onClick:p=>q(o.id)},e[16]||(e[16]=[t("i",{class:"fas fa-times"},null,-1),F(" Quitar ")]),8,It)])]))),128))])])])]),t("div",Ut,[e[19]||(e[19]=t("h3",{class:"text-lg font-semibold text-gray-800 bb"},"Total de la Compra",-1)),t("p",Et,s(w.value.toFixed(2))+" Bs.",1)])])]),h(G)])]),_:1})],64)}}},Rt=K(Mt,[["__scopeId","data-v-e2c90b96"]]);export{Rt as default};
